# GUI 界面配置任务管理员

## 功能位置

在 RuoYuBot 主界面的"主控制"标签页中，你会看到一个新的配置区域：

```
┌─────────────────────────────────────────────────────────┐
│ 若愚Bot                                                  │
├─────────────────────────────────────────────────────────┤
│ [主控制] [定时任务]                                      │
├─────────────────────────────────────────────────────────┤
│                                                          │
│ 回调地址 (每行一个):                                     │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ http://example.com/webhook                          │ │
│ └─────────────────────────────────────────────────────┘ │
│                                            [更新]        │
│                                                          │
│ API Token: [_________________________________] [更新]    │
│                                                          │
│ 本地端口: [5000] [更新]                                  │
│                                                          │
│ 任务管理员 (允许通过消息添加任务的用户，每行一个):       │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 张三                                                 │ │
│ │ 李四                                                 │ │
│ │ 王五                                                 │ │
│ └─────────────────────────────────────────────────────┘ │
│                                            [更新]        │
│                                                          │
│ 监听对象 (每行一个，名称严格区分大小写):                 │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 技术交流群                                           │ │
│ │ 产品讨论组                                           │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                          │
│              [开始]  [停止]                              │
│                                                          │
│ 日志                                                     │
│ ┌─────────────────────────────────────────────────────┐ │
│ │ 2026-02-06 08:00:00 - 任务管理员列表已更新: 张三...  │ │
│ │ 2026-02-06 08:00:01 - 服务已启动                    │ │
│ └─────────────────────────────────────────────────────┘ │
│                                                          │
│ 状态: 运行中                                             │
└─────────────────────────────────────────────────────────┘
```

## 使用步骤

### 1. 打开程序

启动 RuoYuBot.exe 或运行 `python main.py`

### 2. 找到任务管理员配置区域

在主界面的"主控制"标签页中，向下滚动找到"任务管理员"输入框。

这个输入框位于：
- API Token 配置之后
- 本地端口配置之后
- 监听对象配置之前

### 3. 输入管理员名称

在输入框中输入允许添加任务的微信用户名称，**每行一个**。

**重要提示：**
- 名称必须与微信中显示的完全一致（包括大小写、空格等）
- 每个用户名称占一行
- 不要添加额外的空格或标点符号

**正确示例：**
```
张三
李四
王五
```

**错误示例：**
```
张三, 李四, 王五  ❌ (不要用逗号分隔)
张三 李四 王五    ❌ (不要用空格分隔)
```

### 4. 点击更新按钮

输入完成后，点击输入框右下方的"更新"按钮。

### 5. 查看日志确认

在日志区域会显示更新成功的消息：
```
2026-02-06 08:00:00 - 任务管理员列表已更新: 张三, 李四, 王五
```

### 6. 立即生效

配置更新后立即生效，无需重启程序！

## 功能特点

### ✅ 优点

1. **可视化配置** - 不需要手动编辑配置文件
2. **即时生效** - 点击更新后立即生效，无需重启
3. **多行输入** - 每行一个用户，清晰明了
4. **实时反馈** - 日志中显示更新结果
5. **易于管理** - 可以随时添加或删除管理员

### 🔒 安全提示

1. **只添加信任的用户** - 管理员可以通过消息添加任务
2. **定期检查** - 建议定期检查管理员列表
3. **及时更新** - 如果某个用户不再需要权限，及时删除

## 常见操作

### 添加新管理员

1. 在输入框中添加新的用户名称（新起一行）
2. 点击"更新"按钮
3. 查看日志确认更新成功

### 删除管理员

1. 在输入框中删除对应的用户名称行
2. 点击"更新"按钮
3. 查看日志确认更新成功

### 清空所有管理员（禁用功能）

1. 删除输入框中的所有内容
2. 点击"更新"按钮
3. 日志会显示："任务管理员列表已清空（消息添加任务功能已禁用）"

### 查看当前管理员

当前配置的管理员会显示在输入框中，每行一个。

## 与配置文件的关系

### GUI 配置会自动更新配置文件

当你在 GUI 界面中更新任务管理员列表时，程序会自动更新 `config.ini` 文件中的 `task_admin_list` 配置项。

### 配置文件格式

在 `config.ini` 中，管理员列表以逗号分隔的形式存储：
```ini
task_admin_list = 张三,李四,王五
```

### 两种配置方式的对应关系

**GUI 界面输入：**
```
张三
李四
王五
```

**对应的配置文件：**
```ini
task_admin_list = 张三,李四,王五
```

### 手动编辑配置文件

如果你手动编辑了 `config.ini` 文件：
1. 重启程序后，GUI 界面会显示最新的配置
2. 配置格式会自动转换（逗号分隔 → 每行一个）

## 故障排除

### 问题1：更新后没有反应

**解决方案：**
- 检查是否点击了"更新"按钮
- 查看日志区域是否有错误信息
- 确认输入框中的内容格式正确

### 问题2：配置后无法通过消息添加任务

**检查清单：**
- [ ] 是否点击了"更新"按钮？
- [ ] 用户名称是否与微信中完全一致？
- [ ] 是否有多余的空格或特殊字符？
- [ ] 是否已启动服务（点击"开始"按钮）？

### 问题3：日志显示更新成功，但功能不生效

**可能原因：**
- 用户名称与微信中的不完全匹配
- 微信中的名称可能包含特殊字符或空格

**解决方案：**
1. 在微信中确认用户的准确名称
2. 复制粘贴用户名称到输入框（避免手动输入错误）
3. 重新点击"更新"按钮

## 最佳实践

1. **使用复制粘贴** - 从微信中复制用户名称，避免输入错误
2. **测试验证** - 添加管理员后，让该用户发送测试命令验证
3. **定期审查** - 定期检查管理员列表，删除不需要的用户
4. **备份配置** - 定期备份 `config.ini` 文件
5. **最小权限原则** - 只给需要的用户添加管理员权限

## 相关文档

- [QUICKSTART.md](QUICKSTART.md) - 快速开始指南
- [MESSAGE_TASK.md](MESSAGE_TASK.md) - 完整使用手册
- [CONFIG_GUIDE.md](CONFIG_GUIDE.md) - 配置指南
