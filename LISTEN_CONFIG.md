# 监听对象配置说明

## 概述

RuoYuBot 支持两种方式来确定需要监听的微信对象：
1. **手动配置监听对象** - 在"监听对象"输入框中手动添加
2. **自动使用定时任务接收者** - 从启用的定时任务中自动提取接收者

## 配置方式

### 方式一：手动配置监听对象

在主界面的"监听对象"输入框中添加需要监听的群聊或好友名称（每行一个）。

**示例：**
```
技术交流群
产品讨论组
张三
李四
```

### 方式二：仅使用定时任务接收者

如果你只需要定时任务功能，不需要监听其他消息，可以：
1. **不填写监听对象**（留空）
2. 创建定时任务并设置接收者
3. 启动服务

程序会自动使用定时任务的接收者作为监听对象。

**示例场景：**
- 你有一个定时任务，每天 9:00 给"张三"发送消息
- 你不需要监听其他任何消息
- 你可以不填写监听对象，程序会自动监听"张三"

### 方式三：混合使用

你可以同时配置监听对象和定时任务：
- 监听对象：用于接收和转发消息
- 定时任务接收者：用于定时发送消息

程序会合并两者，监听所有相关的对象。

## 启动检查逻辑

程序在启动时会检查：

1. **监听对象列表** - 从"监听对象"输入框获取
2. **定时任务接收者列表** - 从启用的定时任务中提取

### 检查规则

- ✅ **允许启动**：至少有一个监听对象或定时任务接收者
- ❌ **拒绝启动**：两者都为空

### 日志提示

**情况1：有监听对象**
```
2026-02-06 08:00:00 - INFO - 监听列表已更新
2026-02-06 08:00:01 - INFO - 配置已保存
2026-02-06 08:00:02 - INFO - 服务启动成功
```

**情况2：无监听对象，但有定时任务**
```
2026-02-06 08:00:00 - INFO - 未配置监听对象，将使用定时任务接收者: 张三, 李四
2026-02-06 08:00:01 - INFO - 配置已保存
2026-02-06 08:00:02 - INFO - 服务启动成功
```

**情况3：两者都为空**
```
2026-02-06 08:00:00 - ERROR - 请至少添加一个监听对象或创建一个定时任务
```

## 使用场景

### 场景1：纯消息转发

**需求**：只转发消息，不需要定时任务

**配置**：
- 监听对象：✅ 填写需要监听的群聊或好友
- 定时任务：❌ 不需要

### 场景2：纯定时任务

**需求**：只需要定时发送消息，不需要转发其他消息

**配置**：
- 监听对象：❌ 留空
- 定时任务：✅ 创建定时任务并设置接收者

**优点**：
- 简化配置
- 减少不必要的消息监听
- 提高性能

### 场景3：混合使用

**需求**：既要转发消息，又要定时发送消息

**配置**：
- 监听对象：✅ 填写需要监听的群聊或好友
- 定时任务：✅ 创建定时任务并设置接收者

**说明**：
- 程序会合并两个列表
- 自动去重
- 监听所有相关对象

## 实际示例

### 示例1：每日早安机器人

**需求**：每天 8:00 给"张三"发送早安消息

**配置步骤**：
1. 不填写监听对象（留空）
2. 创建定时任务：
   - 类型：每日任务
   - 时间：08:00
   - 接收者：张三
   - 消息：早上好！
3. 点击"开始"启动服务

**日志输出**：
```
2026-02-06 08:00:00 - INFO - 未配置监听对象，将使用定时任务接收者: 张三
2026-02-06 08:00:01 - INFO - 服务启动成功
2026-02-06 08:00:02 - INFO - 从定时任务中添加了 1 个接收者到监听列表
```

### 示例2：群消息转发 + 定时提醒

**需求**：
- 转发"技术交流群"的消息
- 每周一 9:00 给"李四"发送周会提醒

**配置步骤**：
1. 监听对象：填写"技术交流群"
2. 创建定时任务：
   - 类型：每周任务
   - 星期：周一
   - 时间：09:00
   - 接收者：李四
   - 消息：周会时间到了
3. 点击"开始"启动服务

**日志输出**：
```
2026-02-06 08:00:00 - INFO - 监听列表已更新
2026-02-06 08:00:01 - INFO - 服务启动成功
2026-02-06 08:00:02 - INFO - 从定时任务中添加了 1 个接收者到监听列表
2026-02-06 08:00:03 - INFO - 最终监听列表（共 2 个）: 技术交流群, 李四
```

## 注意事项

1. **定时任务必须启用**
   - 只有启用的定时任务的接收者才会被添加到监听列表
   - 禁用的任务不会影响监听列表

2. **多接收者支持**
   - 如果定时任务有多个接收者（逗号分隔），所有接收者都会被添加到监听列表
   - 例如：接收者为"张三, 李四, 王五"，三个人都会被监听

3. **自动去重**
   - 如果监听对象和定时任务接收者有重复，程序会自动去重
   - 每个对象只会被监听一次

4. **动态更新**
   - 如果在运行中修改了定时任务，需要重启服务才能更新监听列表

## 常见问题

### Q1: 我只有定时任务，不填监听对象可以吗？

**A:** 可以！程序会自动使用定时任务的接收者作为监听对象。

### Q2: 如果我既不填监听对象，也没有定时任务会怎样？

**A:** 程序会拒绝启动，并提示"请至少添加一个监听对象或创建一个定时任务"。

### Q3: 定时任务的接收者会被自动监听吗？

**A:** 是的，所有启用的定时任务的接收者都会被自动添加到监听列表。

### Q4: 我可以只监听定时任务接收者，不监听其他人吗？

**A:** 可以！不填写监听对象，只创建定时任务即可。

### Q5: 如果定时任务被禁用了，接收者还会被监听吗？

**A:** 不会。只有启用的定时任务的接收者才会被监听。

## 最佳实践

1. **明确需求**
   - 如果只需要定时任务，不要填写监听对象
   - 如果需要转发消息，填写监听对象

2. **避免冗余**
   - 如果定时任务的接收者已经在监听对象中，不需要重复添加
   - 程序会自动去重

3. **定期检查**
   - 定期检查监听列表和定时任务
   - 删除不需要的配置

4. **查看日志**
   - 启动时查看日志，确认监听列表是否正确
   - 日志会显示最终的监听列表

## 相关文档

- [README.md](README.md) - 项目说明
- [QUICKSTART.md](QUICKSTART.md) - 快速开始
- [MESSAGE_TASK.md](MESSAGE_TASK.md) - 定时任务使用手册
